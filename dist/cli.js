"use strict";var e=require("commander"),t=require("tslib"),r=require("chalk"),n=require("figlet"),i=require("readline"),o=require("fs-extra"),a=require("inquirer"),c=require("path"),s=require("fs");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=u(r),l=u(c);const p=e=>console.log(e),m=require("ora"),v=require("download-git-repo"),f=(e,r)=>t.__awaiter(void 0,void 0,void 0,(function*(){return new Promise(((n,i)=>{let o;switch(e){case"taro":o="github:zhengzhuang96/taro-react#main";break;case"react-admin":o="git@github.com:zhengzhuang96/react-admin-project-template.git#master"}const a=m(`🚕 正在创建 ${e} 项目模版...\n`);a.start(),v(o,r,{clone:!0},(function(e){return t.__awaiter(this,void 0,void 0,(function*(){p(e?`Error: ${e}`:"Success"),e?(a.fail(`🚕 下载失败: ${e}`),n(!1)):(a.succeed("🚕 下载成功"),n(!0))}))}))}))})),g=require("cross-spawn"),y=require("chalk");var w="0.0.8";const h=()=>t.__awaiter(void 0,void 0,void 0,(function*(){(()=>{const e="\n".repeat(process.stdout.rows);console.log(e),i.cursorTo(process.stdout,0,0),i.clearScreenDown(process.stdout)})(),p(d.default.yellow(n.textSync("peak-cli",{horizontalLayout:"full"}))),p(`🗼 peak-cli v${w}`),p(""),p(d.default.green("peak-cli 即将创建一个新项目!")),p("需要帮助? 请在 https://github.com/zhengzhuang96/peak-cli 提交issue"),p("");const{project:e,description:r,typeProject:u,nodeInstall:m}=yield t.__awaiter(void 0,void 0,void 0,(function*(){const e=[{type:"input",name:"project",message:"请输入项目名称",validate:e=>t.__awaiter(void 0,void 0,void 0,(function*(){if(!e)return"请输入项目名称";const t=c.join(process.cwd(),e);return!o.existsSync(t)||`目标目录 ${d.default.cyan(t)} 已经存在，请换一个项目名！`}))},{type:"input",name:"description",message:"请输入项目介绍"},{type:"list",name:"nodeInstall",message:"使用那种方式构建项目?",default:"yarn",choices:[{name:"yarn",value:"yarn"},{name:"pnpm",value:"pnpm"},{name:"npm",value:"npm"}]},{type:"list",name:"typeProject",message:"项目类型",default:"vue",choices:[{name:"react - react admin",value:"react-admin"},{name:"taro - 移动端跨平台",value:"taro"}]}],{project:r,description:n,typeProject:i,nodeInstall:s}=yield a.prompt(e);return{project:r,description:n,typeProject:i,nodeInstall:s}}));yield f(u,e),yield((e,r)=>t.__awaiter(void 0,void 0,void 0,(function*(){const t=require(c.join(process.cwd(),e,"package.json"));return t.name=e,t.description=r,yield s.writeFileSync(c.join(process.cwd(),e,"package.json"),JSON.stringify(t,null,2)),!0})))(e,r),yield((e,t)=>new Promise(((r,n)=>{p(""),p(y.green("🐌 开始安装依赖项...")),p("");const i=l.default.join(process.cwd(),t);g(e,["install"],{cwd:i,stdio:"inherit"}).on("close",(function(e){p(""),p(y.green("🐌 安装依赖项完成!")),r()}))})))(m,e),((e,t,r)=>{const n=`${t}`;if("taro"===t){p(`\r\n成功创建了项目 ${d.default.green(r)}`),p(`\r\n  cd ${d.default.green(r)}`);const t="yarn"===e?"yarn":`${e} run`;p(`  ${d.default.green(`${t} dev:weapp`)}\r\n`)}})(m,u,e)})),j=new e.Command;j.version(w).command("create").description("创建新的项目").action((()=>{h()})),j.parse();
