#!/usr/bin/env node
"use strict";var e=require("commander"),r=require("tslib"),n=require("chalk"),t=require("figlet"),o=require("readline"),i=require("fs-extra"),a=require("inquirer"),c=require("path"),s=require("fs");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=u(n),l=u(c);const p=e=>console.log(e),f=require("ora"),v=require("download-git-repo"),m=(e,n)=>r.__awaiter(void 0,void 0,void 0,(function*(){return new Promise(((t,o)=>{let i;if("taro"===e)i="github:zhengzhuang96/taro-react#main";const a=f(`ğŸš• æ­£åœ¨åˆ›å»º ${e} é¡¹ç›®æ¨¡ç‰ˆ...\n`);a.start(),v(i,n,{clone:!0},(function(e){return r.__awaiter(this,void 0,void 0,(function*(){p(e?`Error: ${e}`:"Success"),e?(a.fail(`ğŸš• ä¸‹è½½å¤±è´¥: ${e}`),t(!1)):(a.succeed("ğŸš• ä¸‹è½½æˆåŠŸ"),t(!0))}))}))}))})),y=require("cross-spawn"),g=require("chalk");var w="0.0.7";const h=()=>r.__awaiter(void 0,void 0,void 0,(function*(){(()=>{const e="\n".repeat(process.stdout.rows);console.log(e),o.cursorTo(process.stdout,0,0),o.clearScreenDown(process.stdout)})(),p(d.default.yellow(t.textSync("peak-cli",{horizontalLayout:"full"}))),p(`ğŸ—¼ peak-cli v${w}`),p(""),p(d.default.green("peak-cli å³å°†åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®!")),p("éœ€è¦å¸®åŠ©? è¯·åœ¨ https://github.com/zhengzhuang96/peak-cli æäº¤issue"),p("");const{project:e,description:n,typeProject:u,nodeInstall:f}=yield r.__awaiter(void 0,void 0,void 0,(function*(){const e=[{type:"input",name:"project",message:"è¯·è¾“å…¥é¡¹ç›®åç§°",validate:e=>r.__awaiter(void 0,void 0,void 0,(function*(){if(!e)return"è¯·è¾“å…¥é¡¹ç›®åç§°";const r=c.join(process.cwd(),e);return!i.existsSync(r)||`ç›®æ ‡ç›®å½• ${d.default.cyan(r)} å·²ç»å­˜åœ¨ï¼Œè¯·æ¢ä¸€ä¸ªé¡¹ç›®åï¼`}))},{type:"input",name:"description",message:"è¯·è¾“å…¥é¡¹ç›®ä»‹ç»"},{type:"list",name:"nodeInstall",message:"ä½¿ç”¨é‚£ç§æ–¹å¼æ„å»ºé¡¹ç›®?",default:"yarn",choices:[{name:"yarn",value:"yarn"},{name:"pnpm",value:"pnpm"},{name:"npm",value:"npm"}]},{type:"list",name:"typeProject",message:"é¡¹ç›®ç±»å‹",default:"vue",choices:[{name:"taro",value:"taro"}]}],{project:n,description:t,typeProject:o,nodeInstall:s}=yield a.prompt(e);return{project:n,description:t,typeProject:o,nodeInstall:s}}));yield m(u,e),yield((e,n)=>r.__awaiter(void 0,void 0,void 0,(function*(){const r=require(c.join(process.cwd(),e,"package.json"));return r.name=e,r.description=n,yield s.writeFileSync(c.join(process.cwd(),e,"package.json"),JSON.stringify(r,null,2)),!0})))(e,n),yield((e,r)=>new Promise(((n,t)=>{p(""),p(g.green("ğŸŒ å¼€å§‹å®‰è£…ä¾èµ–é¡¹...")),p("");const o=l.default.join(process.cwd(),r);y(e,["install"],{cwd:o,stdio:"inherit"}).on("close",(function(e){p(""),p(g.green("ğŸŒ å®‰è£…ä¾èµ–é¡¹å®Œæˆ!")),n()}))})))(f,e),((e,r,n)=>{const t=`${r}`;if("taro"===r){p(`\r\næˆåŠŸåˆ›å»ºäº†é¡¹ç›® ${d.default.green(n)}`),p(`\r\n  cd ${d.default.green(n)}`);const r="yarn"===e?"yarn":`${e} run`;p(`  ${d.default.green(`${r} dev:weapp`)}\r\n`)}})(f,u,e)})),j=new e.Command;j.version(w).command("create").description("åˆ›å»ºæ–°çš„é¡¹ç›®").action((()=>{h()})),j.parse();
